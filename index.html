<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PageRank Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    button {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PageRank Calculator</h1>
    <label for="matrixInput">Enter adjacency matrix (comma-separated rows, space-separated elements):</label>
    <textarea id="matrixInput"></textarea>
    <label for="dampingInput">Damping Factor (default: 0.85):</label>
    <input type="text" id="dampingInput" placeholder="0.85" />
    <label for="toleranceInput">Tolerance (default: 1e-10):</label>
    <input type="text" id="toleranceInput" placeholder="1e-10" />
    <button id="calculateButton">Calculate PageRank</button>
    <h2>Results</h2>
    <div id="results"></div>
  </div>

  <script>
    document.getElementById("calculateButton").addEventListener("click", () => {
      const matrixInput = document.getElementById("matrixInput").value;
      const dampingInput = parseFloat(document.getElementById("dampingInput").value || 0.85);
      const toleranceInput = parseFloat(document.getElementById("toleranceInput").value || 1e-10);

      const rows = matrixInput.trim().split("\n").map(row => row.split(" ").map(Number));
      const size = rows.length;

      // Verify input is square matrix
      if (!rows.every(row => row.length === size)) {
        alert("Matrix must be square (NxN).");
        return;
      }

      // Calculate PageRank
      const results = calculatePageRank(rows, dampingInput, toleranceInput);

      // Display results
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<strong>Rankings:</strong><br>";
      results.forEach((site, index) => {
        resultsDiv.innerHTML += `${index + 1}ยบ: Site ${site[0]} - Score: ${site[1].toFixed(10)}<br>`;
      });
    });

    function calculatePageRank(adjMatrix, damping, tolerance) {
      const size = adjMatrix.length;
      const transitionMatrix = createTransitionMatrix(adjMatrix, damping, size);
      let rankVector = Array(size).fill(1 / size);

      let converged = false;
      let iterations = 0;

      while (!converged && iterations < 1000) {
        const newRank = multiplyMatrixVector(transitionMatrix, rankVector);
        const diff = newRank.map((val, i) => Math.abs(val - rankVector[i])).reduce((a, b) => a + b, 0);

        if (diff < tolerance) {
          converged = true;
        }
        rankVector = newRank;
        iterations++;
      }

      return rankVector
        .map((val, index) => [index + 1, val])
        .sort((a, b) => b[1] - a[1]);
    }

    function createTransitionMatrix(adjMatrix, damping, size) {
      const columnSums = Array(size).fill(0);

      adjMatrix.forEach(row => row.forEach((val, col) => (columnSums[col] += val)));

      // Normalize the adjacency matrix
      const normalizedMatrix = adjMatrix.map(row =>
        row.map((val, col) => (columnSums[col] === 0 ? 0 : val / columnSums[col]))
      );

      // Apply damping factor
      const teleportMatrix = Array(size)
        .fill(0)
        .map(() => Array(size).fill(1 / size));
      return normalizedMatrix.map((row, i) =>
        row.map((val, j) => damping * val + (1 - damping) * teleportMatrix[i][j])
      );
    }

    function multiplyMatrixVector(matrix, vector) {
      const size = vector.length;
      const result = Array(size).fill(0);

      matrix.forEach((row, i) => {
        row.forEach((val, j) => {
          result[i] += val * vector[j];
        });
      });

      return result;
    }
  </script>
</body>
</html>
